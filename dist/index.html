<!doctype html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>BÃ©nÃ©voles Escalade - Inscription</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet"><script type="module" crossorigin src="./assets/main-BZyUjo8o.js"></script><link rel="modulepreload" crossorigin href="./assets/utils-Bh8kB5Eo.js"><link rel="stylesheet" crossorigin href="./assets/utils-7krzjOQW.css"></head><body class="bg-brutal-ice min-h-screen" x-data="app()" x-init="init()"><div class="fixed top-4 right-4 z-50 space-y-2"><template x-for="toast in toasts" :key="toast.id"><div class="toast brutal-card px-6 py-4 max-w-md" :class="toast.type === 'error' ? 'bg-brutal-black text-brutal-ice' : 'bg-brutal-ice text-brutal-black'"><p class="font-bold" x-text="toast.message"></p></div></template></div><div x-show="confirmModal.open" class="fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm" style="display:none" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"><div class="brutal-card bg-brutal-white p-8 max-w-md w-full mx-4 shadow-brutal border-4 border-brutal-black" @click.outside="handleConfirm(false)" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-90" x-transition:enter-end="opacity-100 transform scale-100" x-transition:leave="transition ease-in duration-200" x-transition:leave-start="opacity-100 transform scale-100" x-transition:leave-end="opacity-0 transform scale-90"><h3 class="text-2xl font-black mb-4" x-text="confirmModal.title">Confirmation</h3><p class="text-lg mb-8" x-text="confirmModal.message"></p><div class="flex flex-col sm:flex-row justify-end gap-4"><button @click="handleConfirm(false)" class="brutal-btn bg-white border-2 border-black px-6 py-3 hover:bg-gray-100 w-full sm:w-auto">Non / Annuler</button> <button @click="handleConfirm(true)" class="brutal-btn bg-brutal-ice px-6 py-3 shadow-brutal-sm hover:bg-blue-300 w-full sm:w-auto">Oui / Confirmer</button></div></div></div><header class="bg-brutal-black text-brutal-white py-8 mb-8 border-b-8 border-brutal-black"><div class="container mx-auto px-4 relative"><div class="absolute top-0 right-4 hidden md:block" x-show="user" style="display:none"><button @click="openWizard()" class="brutal-btn bg-yellow-400 text-black px-4 py-2 font-bold shadow-brutal-white border-2 border-white hover:bg-white transition-colors flex items-center gap-2"><span>ğŸª„</span> Assistant</button></div><h1 class="text-5xl font-black text-center tracking-tight">ğŸ§— BÃ‰NÃ‰VOLES ESCALADE</h1><p class="text-center mt-2 text-xl font-body">Inscrivez-vous pour aider la compÃ©tition</p><div class="mt-6 flex justify-center md:hidden" x-show="user" style="display:none"><button @click="openWizard()" class="brutal-btn bg-yellow-400 text-black px-6 py-2 font-bold shadow-brutal-white border-2 border-white hover:bg-white text-lg flex items-center gap-2"><span>ğŸª„</span> Assistant d'inscription</button></div></div></header><main class="container mx-auto px-4 pb-12"><template x-if="!user"><section class="mb-12"><div class="max-w-md mx-auto"><div class="brutal-card bg-brutal-white p-8"><h2 class="text-3xl font-black mb-6">Connexion</h2><form @submit.prevent="sendMagicLink()"><div class="mb-4"><label for="email" class="block font-bold mb-2 text-lg">Votre email</label> <input type="email" id="email" x-model="loginEmail" required placeholder="jean.dupont@example.com" class="brutal-input w-full px-4 py-3 text-lg"></div><button type="submit" :disabled="loading" class="brutal-btn bg-brutal-ice w-full py-4 text-xl shadow-brutal"><span x-show="!loading">ğŸ“§ Recevoir le lien de connexion</span> <span x-show="loading" x-cloak>â³ Envoi en cours...</span></button></form><p class="mt-4 text-sm text-center">Vous recevrez un email avec un lien magique pour vous connecter sans mot de passe.</p></div></div></section></template><section x-show="user" style="display:none"><div class="sticky top-0 z-40 brutal-card bg-brutal-white p-4 mb-6 flex flex-col md:flex-row md:justify-between md:items-center gap-4 shadow-brutal border-b-2 border-brutal-black"><div><p class="text-sm font-bold text-gray-600">Bienvenue,</p><p class="text-2xl font-black" x-text="user?.email"></p><span x-show="profiles.some(p => p.role === 'admin')" class="inline-block mt-2 px-3 py-1 bg-brutal-black text-brutal-white font-bold text-sm border-2 border-brutal-black">ğŸ” Administrateur</span></div><div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto"><a x-show="profiles.some(p => p.role === 'admin')" href="admin.html" class="brutal-btn bg-brutal-ice px-6 py-3 shadow-brutal-sm text-center">ğŸ” Admin </a><button @click="toggleProfileSection()" class="brutal-btn bg-brutal-white text-brutal-black px-6 py-3 shadow-brutal-sm w-full sm:w-auto border-2 border-brutal-black">ğŸ‘¤ GÃ©rer les profils</button> <button @click="logout()" class="brutal-btn bg-brutal-black text-brutal-white px-6 py-3 shadow-brutal-sm w-full sm:w-auto">Se dÃ©connecter</button></div></div><div x-show="user && (profiles.length === 0 || showProfileSection)" class="brutal-card bg-brutal-white p-4 mb-6"><div x-show="!isEditingProfile"><div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-black">ğŸ‘¤ Mes BÃ©nÃ©voles</h2><button @click="createProfile()" class="brutal-btn bg-brutal-ice px-4 py-2 shadow-brutal-sm text-sm">+ Ajouter</button></div><div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"><template x-for="p in profiles" :key="p.id"><div class="border-2 border-brutal-black p-4 bg-gray-50 relative"><h3 class="font-bold text-xl" x-text="p.prenom + ' ' + p.nom"></h3><p class="text-gray-600" x-text="p.email"></p><p class="text-sm mt-2">ğŸ‘• Taille: <span x-text="p.taille_tshirt"></span></p><div class="flex gap-2 mt-4"><button @click="editProfile(p.id)" class="flex-1 brutal-btn bg-white border-2 border-black py-2 text-sm hover:bg-gray-100">âœï¸ Modifier</button> <button @click="deleteProfile(p.id)" class="brutal-btn bg-red-500 text-white border-2 border-black py-2 px-4 text-sm hover:bg-red-600">ğŸ—‘ï¸</button></div></div></template><div x-show="profiles.length === 0" class="col-span-full text-center py-8 text-gray-500 italic">Aucun profil bÃ©nÃ©vole. CrÃ©ez-en un pour commencer !</div></div><div class="mt-6 text-right" x-show="profiles.length > 0"><button @click="toggleProfileSection()" class="underline font-bold text-gray-600">Fermer et voir les postes</button></div></div><div x-show="isEditingProfile"><h2 class="text-2xl font-black mb-4" x-text="profileForm.id ? 'Modifier le profil' : 'Nouveau bÃ©nÃ©vole'"></h2><form @submit.prevent="saveProfile()"><div class="grid md:grid-cols-2 gap-4 mb-4"><div><label class="block font-bold mb-2">PrÃ©nom *</label> <input x-model="profileForm.prenom" required class="brutal-input w-full px-4 py-2" placeholder="Jean"></div><div><label class="block font-bold mb-2">Nom *</label> <input x-model="profileForm.nom" required class="brutal-input w-full px-4 py-2" placeholder="Dupont"></div></div><div class="mb-4"><label class="block font-bold mb-2">TÃ©lÃ©phone *</label> <input type="tel" x-model="profileForm.telephone" class="brutal-input w-full px-4 py-2" placeholder="06 12 34 56 78"></div><div class="mb-6"><label class="block font-bold mb-2">Taille T-shirt *</label> <select x-model="profileForm.taille_tshirt" required class="brutal-input w-full px-4 py-2 font-bold"><option value="">-- SÃ©lectionnez --</option><option value="XS">XS</option><option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="XL">XL</option><option value="XXL">XXL</option></select></div><div class="flex flex-col md:flex-row gap-4"><button type="submit" :disabled="loading" class="brutal-btn bg-brutal-ice w-full py-2 text-lg shadow-brutal"><span x-show="!loading">âœ… Enregistrer</span> <span x-show="loading">â³ Enregistrement...</span></button> <button type="button" @click="cancelEdit()" class="brutal-btn bg-gray-200 text-black w-full md:w-auto py-2 text-lg shadow-brutal-sm">Annuler</button></div></form></div></div>--><div x-show="profiles.length > 0 && !showProfileSection"><div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4"><h2 class="text-3xl font-black text-brutal-black" x-text="showReferentView ? 'ğŸ‘¥ Liste de mes bÃ©nÃ©voles' : ((showMyInscriptions || viewMode === 'week') ? 'âœ… Mes inscriptions' : 'ğŸ“‹ Formulaires d\'inscription')"></h2><div class="flex flex-wrap gap-3 items-center"><div x-show="showMyInscriptions && profiles.length > 1" class="md:hidden"><select x-model="selectedVolunteerId" class="brutal-input py-2 pl-3 pr-8 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm focus:outline-none focus:ring-0"><option value="">Tous les bÃ©nÃ©voles</option><template x-for="profile in profiles" :key="profile.id"><option :value="profile.id" x-text="profile.prenom"></option></template></select></div><div x-show="!showReferentView && !showMyInscriptions && viewMode === 'list'" class="flex gap-3"><button @click="toggleView()" class="hidden md:inline-flex brutal-btn px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm transition-all active:scale-95 items-center gap-2 bg-brutal-ice text-brutal-black"><span>âœ… Mes inscriptions</span></button> <button @click="showMyInscriptions = true" class="md:hidden brutal-btn px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm transition-all active:scale-95 flex items-center gap-2 bg-brutal-ice text-brutal-black"><span>âœ… Mes inscriptions</span></button> <button x-show="isReferent()" @click="toggleReferentView()" class="brutal-btn px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm transition-all active:scale-95 flex items-center gap-2 bg-brutal-ice text-brutal-black"><span>ğŸ‘¥ Liste de mes bÃ©nÃ©voles</span></button></div><button x-show="showReferentView || showMyInscriptions || viewMode === 'week'" @click="viewMode = 'list'; showMyInscriptions = false; showReferentView = false; calendarPage = 0;" class="brutal-btn px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm transition-all active:scale-95 flex items-center gap-2 bg-brutal-black text-brutal-white"><span>ğŸ“‹ Revenir aux inscriptions</span></button> <button x-show="showReferentView && referentProfiles.length > 1" @click="showReferentSelectionModal = true" class="brutal-btn bg-yellow-400 text-brutal-black px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm transition-all active:scale-95 flex items-center gap-2"><span>ğŸ”„ Changer de rÃ©fÃ©rent</span></button></div></div><div x-show="!showReferentView"><div x-show="viewMode === 'week'" class="animate-fade-in"><div class="flex justify-between items-center mb-4" x-show="getCalendarData().length > 0"><button @click="prevPage()" :disabled="!hasPrevPage()" class="brutal-btn px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm disabled:opacity-50 disabled:cursor-not-allowed" :class="hasPrevPage() ? 'bg-brutal-ice text-brutal-black' : 'bg-gray-200 text-gray-500'">â—€ PrÃ©cÃ©dent</button> <span class="font-bold text-lg">Page <span x-text="calendarPage + 1"></span> </span><button @click="nextPage()" :disabled="!hasNextPage()" class="brutal-btn px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm disabled:opacity-50 disabled:cursor-not-allowed" :class="hasNextPage() ? 'bg-brutal-ice text-brutal-black' : 'bg-gray-200 text-gray-500'">Suivant â–¶</button></div><div class="brutal-card bg-brutal-white p-4 mb-8 w-full overflow-x-auto overflow-y-hidden"><div class="flex flex-wrap gap-6"><template x-for="day in getCalendarData()" :key="day.date.getTime()"><div class="flex-1 min-w-max border-2 border-brutal-black p-2"><div class="bg-brutal-black text-brutal-white p-2 mb-4 text-center sticky top-0 z-10"><h3 class="font-black uppercase text-lg" x-text="day.formattedDate"></h3></div><div class="flex gap-2 h-full pb-2"><template x-for="pData in day.profiles" :key="pData.profile.id"><div class="flex-1 flex flex-col gap-3 min-w-[180px]"><div x-show="profiles.length > 1" class="text-center mb-2 border-b-2 border-brutal-black pb-1"><span class="font-bold text-sm bg-brutal-ice px-2 py-1 border border-brutal-black" x-text="pData.profile.prenom"></span></div><div class="relative w-full" :style="'height: ' + getCalendarHeight()"><template x-for="poste in pData.postes" :key="poste.poste_id"><div class="border-2 border-brutal-black p-2 shadow-brutal-sm bg-green-50 overflow-hidden flex flex-col gap-1" :style="getPosteStyle(poste)"><div class="text-xs font-bold text-brutal-black bg-brutal-ice inline-block px-1 border border-brutal-black self-start"><span x-text="pData.profile.prenom"></span></div><div class="text-xs font-bold bg-white inline-block px-1 py-0.5 border border-brutal-black self-start"><span x-text="formatTime(poste.periode_debut)"></span> - <span x-text="formatTime(poste.periode_fin)"></span></div><h4 class="font-bold text-sm leading-tight truncate" x-text="poste.titre"></h4><div x-show="poste.referent_nom" class="text-xs text-gray-600 truncate mt-auto">ğŸ‘¤ <span x-text="poste.referent_nom"></span></div></div></template></div></div></template></div></div></template><div x-show="getCalendarData().length === 0" class="w-full text-center py-12"><p class="text-xl font-bold text-gray-500">Aucune inscription Ã  afficher pour cette pÃ©riode.</p><button @click="viewMode = 'list'" class="mt-4 brutal-btn bg-brutal-ice px-4 py-2 text-sm font-bold border-2 border-brutal-black shadow-brutal-sm">Voir tous les postes disponibles</button></div></div></div><div x-show="getCalendarData().length > 0" class="mb-12"><h3 class="text-2xl font-black text-brutal-black mb-6">ğŸ“ RÃ©fÃ©rents de vos postes</h3><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><template x-for="ref in getMyReferentsList()" :key="ref.id"><div class="brutal-card bg-white p-4 flex flex-col gap-2"><div class="flex items-center gap-3 mb-2"><div class="w-10 h-10 bg-brutal-black text-brutal-white rounded-full flex items-center justify-center font-bold text-lg"><span x-text="ref.nom.charAt(0)"></span></div><h4 class="font-black text-lg" x-text="ref.nom"></h4></div><div class="space-y-1 text-sm"><p x-show="ref.email" class="flex items-center gap-2">ğŸ“§ <a :href="'mailto:' + ref.email" class="hover:underline font-bold" x-text="ref.email"></a></p><p x-show="ref.telephone" class="flex items-center gap-2">ğŸ“± <a :href="'tel:' + ref.telephone" class="hover:underline font-bold" x-text="ref.telephone"></a></p></div><div class="mt-2 pt-2 border-t-2 border-brutal-black border-dashed" x-show="ref.posts.length > 0"><p class="text-xs font-bold text-gray-500 mb-1">Concernant :</p><ul class="list-disc list-inside text-xs font-bold text-brutal-black"><template x-for="postTitle in ref.posts"><li x-text="postTitle"></li></template></ul></div></div></template></div></div></div></div><div x-show="showReferentView" class="animate-fade-in"><template x-for="group in getReferentViewData()" :key="group.name + '-' + selectedReferentProfileId"><div class="mb-12" x-data="{ open: false }"><div @click="open = !open" class="brutal-card bg-brutal-black text-brutal-white p-4 mb-6 cursor-pointer hover:bg-gray-900 transition-colors flex justify-between items-center select-none"><h3 class="text-2xl font-black uppercase tracking-wide" x-text="group.name"></h3><div class="text-4xl transform transition-transform duration-300" :class="open ? 'rotate-180' : ''">â–¼</div></div><div class="grid gap-6" x-show="open" x-transition><template x-for="poste in group.postes" :key="poste.id"><div class="brutal-card p-6 bg-white"><div class="mb-6 border-b-2 border-brutal-black pb-4"><h4 class="text-xl font-black mb-2" x-text="poste.titre"></h4><p class="text-base font-bold text-gray-700">ğŸ“… <span x-text="formatDate(poste.periode_debut)"></span> - <span x-text="formatTime(poste.periode_debut)"></span> Ã  <span x-text="formatTime(poste.periode_fin)"></span></p><p class="text-sm font-bold text-gray-600 mt-2 flex items-center gap-2"><span>ğŸ“Š Inscrits : <span x-text="poste.inscrits_actuels"></span></span> <span class="text-gray-400">|</span> <span>Min : <span x-text="poste.nb_min"></span></span> <span class="text-gray-400">-</span> <span>Max : <span x-text="poste.nb_max"></span></span></p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><template x-for="vol in poste.volunteers" :key="vol.id"><div class="border-2 border-gray-200 p-3 bg-gray-50 hover:bg-white hover:border-brutal-black transition-colors"><div class="font-black text-lg mb-1" x-text="vol.prenom + ' ' + vol.nom"></div><div class="flex flex-col gap-1 text-sm"><a :href="'tel:' + vol.telephone" class="flex items-center gap-2 hover:underline text-gray-700"><span>ğŸ“</span> <span x-text="vol.telephone"></span> </a><a :href="'mailto:' + vol.email" class="flex items-center gap-2 hover:underline text-gray-700"><span>âœ‰ï¸</span> <span x-text="vol.email"></span></a></div></div></template></div><div x-show="poste.volunteers.length === 0" class="text-center italic text-gray-500 py-4">Aucun bÃ©nÃ©vole inscrit pour le moment.</div></div></template></div></div></template><div x-show="referentInscriptions.length === 0 && !loading" class="text-center py-12"><p class="text-xl font-bold text-gray-500">Aucune inscription trouvÃ©e pour vos postes.</p></div></div><div x-show="viewMode === 'list' && !showReferentView" class="animate-fade-in"><template x-for="group in groupedPostes()" :key="group.name"><div class="mb-12" x-data="{ open: true }"><div @click="open = !open" class="brutal-card bg-brutal-black text-brutal-white p-4 mb-4 cursor-pointer hover:bg-gray-900 transition-colors flex justify-between items-center select-none"><div><h3 class="text-2xl font-black uppercase tracking-wide" x-text="group.name"></h3><div class="mt-2 flex items-center gap-4"><span class="font-bold text-lg">ğŸ“Š <span x-text="group.totalPostes"></span> poste<span x-show="group.totalPostes > 1">s</span> </span><span class="font-bold text-lg">ğŸ‘¥ <span x-text="group.totalInscrits"></span> / <span x-text="group.totalMax"></span> inscrit<span x-show="group.totalInscrits > 1">s</span></span></div></div><div class="text-4xl transform transition-transform duration-300" :class="open ? 'rotate-180' : ''">â–¼</div></div><div class="grid gap-6" x-show="open" x-transition><template x-for="subgroup in group.subgroups" :key="subgroup.id"><div class="mb-4" x-data="{ openSub: subgroup.expanded }"><div @click="openSub = !openSub" x-show="subgroup.title" class="flex justify-between items-center bg-gray-200 p-3 cursor-pointer select-none border-l-4 border-brutal-black hover:bg-gray-300 transition-colors mb-4"><h4 class="text-lg font-black uppercase text-brutal-black" x-text="subgroup.title"></h4><div class="text-xl transform transition-transform duration-300" :class="openSub ? 'rotate-180' : ''">â–¼</div></div><div class="grid gap-6 pl-0 md:pl-2" x-show="openSub" x-transition><template x-for="poste in subgroup.postes" :key="poste.poste_id"><div><div class="brutal-card p-4" :class="isUserRegistered(poste.poste_id) ? 'bg-green-50' : 'bg-brutal-white'"><div class="mb-4 flex flex-col md:flex-row md:items-center md:gap-6"><h4 class="text-xl font-black" x-text="poste.titre"></h4><p class="text-base font-bold text-gray-700">ğŸ“… <span x-text="formatDate(poste.periode_debut)"></span> - <span x-text="formatTime(poste.periode_debut)"></span> Ã  <span x-text="formatTime(poste.periode_fin)"></span></p><div x-show="poste.referent_nom" class="md:ml-auto"><p class="font-bold">ğŸ‘¤ RÃ©fÃ©rent : <span x-text="poste.referent_nom"></span></p></div></div><div x-show="poste.description" class="mb-4 p-3 bg-gray-100 border-2 border-brutal-black"><p class="font-bold" x-text="poste.description"></p></div><div class="mb-4"><div class="flex justify-between mb-2"><span class="font-bold">Inscrits</span> <span class="font-black" x-text="poste.inscrits_actuels + ' / ' + poste.nb_max"></span></div><div class="progress-bar relative overflow-visible"><div class="progress-fill" :class="{
                'bg-red-500': poste.inscrits_actuels < (poste.nb_min || 0),
                'bg-green-400': poste.inscrits_actuels >= (poste.nb_min || 0) && poste.inscrits_actuels < poste.nb_max,
                'bg-green-700': poste.inscrits_actuels >= poste.nb_max
            }" :style="'width: ' + ((poste.inscrits_actuels / poste.nb_max) * 100) + '%'"></div><div x-show="poste.nb_min > 0" class="absolute top-0 bottom-0 w-0.5 bg-black z-10" :style="'left: ' + ((poste.nb_min / poste.nb_max) * 100) + '%'"><div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-bold whitespace-nowrap">Mini : <span x-text="poste.nb_min"></span></div></div></div></div><div class="mb-4"><template x-if="showMyInscriptions"><div x-show="getRegisteredProfiles(poste.poste_id).length > 0"><p class="font-bold mb-2">Vos inscrits :</p><div class="flex flex-wrap gap-2"><template x-for="profile in getRegisteredProfiles(poste.poste_id)" :key="profile.id"><span class="px-3 py-1 bg-green-600 text-white font-bold text-sm border-2 border-green-800"><span x-text="profile.prenom"></span></span></template></div></div></template><template x-if="!showMyInscriptions"><div x-show="poste.liste_benevoles && poste.liste_benevoles.length > 0"><p class="font-bold mb-2">BÃ©nÃ©voles inscrits :</p><div class="flex flex-wrap gap-2"><template x-for="benevole in poste.liste_benevoles" :key="benevole"><span class="px-3 py-1 bg-brutal-black text-brutal-white font-bold text-sm border-2 border-brutal-black"><span x-text="benevole"></span></span></template></div></div></template></div><div class="flex flex-col sm:flex-row gap-4 mt-6"><div x-show="profiles.length > 0" class="flex flex-wrap gap-3" :class="{'hidden md:flex': showMyInscriptions}"><template x-for="profile in profiles" :key="profile.id"><div class="inline-block"><template x-if="wizardOpen"><button x-show="isProfileRegistered(poste.poste_id, profile.id) || (!hasTimeConflict(poste, profile.id) && poste.inscrits_actuels < poste.nb_max)" @click="isProfileRegistered(poste.poste_id, profile.id) 
                                ? unregister(poste.poste_id, profile.id) 
                                : register(poste.poste_id, profile.id)" class="brutal-btn px-6 py-2 font-bold shadow-brutal-sm transition-all active:scale-95" :class="isProfileRegistered(poste.poste_id, profile.id) 
                                ? 'bg-red-500 text-white border-red-700' 
                                : 'bg-brutal-ice text-brutal-black'"><span x-text="
                                isProfileRegistered(poste.poste_id, profile.id)
                                    ? (profiles.length > 1 ? 'DÃ©sinscrire ' + profile.prenom : 'Se dÃ©sinscrire')
                                    : (profiles.length > 1 ? 'Inscrire ' + profile.prenom : 'S\'inscrire')
                            "></span></button></template><button x-show="!isProfileRegistered(poste.poste_id, profile.id) && hasTimeConflict(poste, profile.id)" disabled="disabled" class="brutal-btn px-4 py-1 font-bold border-2 border-gray-400 bg-gray-200 text-gray-500 cursor-not-allowed opacity-70 flex flex-col items-center leading-tight"><span class="line-through" x-text="profile.prenom"></span> <span class="text-[10px]">CrÃ©neau pris</span></button> <button x-show="!isProfileRegistered(poste.poste_id, profile.id) && !hasTimeConflict(poste, profile.id) && poste.inscrits_actuels >= poste.nb_max" disabled="disabled" class="brutal-btn px-4 py-1 font-bold border-2 border-gray-400 bg-gray-200 text-gray-500 cursor-not-allowed opacity-70 flex flex-col items-center leading-tight"><span x-text="profile.prenom"></span> <span class="text-[10px]">CrÃ©neau complet</span></button></div></template></div><p x-show="profiles.length === 0" class="text-red-600 font-bold italic">CrÃ©ez un profil bÃ©nÃ©vole pour vous inscrire.</p></div></div></div></template></div></div></template></div></div></template></div><div x-show="showReferentSelectionModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm" x-transition.opacity><div class="brutal-card bg-brutal-white p-8 max-w-md w-full mx-4 relative" @click.away="showReferentSelectionModal = false"><h3 class="text-2xl font-black mb-6 text-center">Choisir le profil rÃ©fÃ©rent</h3><div class="grid gap-4"><template x-for="profile in referentProfiles" :key="profile.id"><button @click="selectReferent(profile.id)" class="brutal-btn w-full py-4 text-lg font-bold border-2 border-brutal-black shadow-brutal hover:bg-brutal-ice transition-colors flex items-center justify-center gap-3"><span class="text-2xl">ğŸ‘¤</span> <span x-text="profile.prenom + ' ' + profile.nom"></span></button></template></div><button @click="showReferentSelectionModal = false; if(!selectedReferentProfileId) showReferentView = false" class="mt-6 w-full text-center underline font-bold text-gray-600 hover:text-black">Annuler</button></div></div></div></section></main><div class="fixed bottom-6 right-6 z-40" x-show="!wizardOpen"><button @click="openWizardWithContext(null, null, 'register')" class="brutal-btn bg-yellow-400 text-brutal-black px-6 py-4 rounded-full shadow-brutal border-2 border-brutal-black font-black text-lg flex items-center gap-3 hover:scale-105 transition-transform"><span>âœï¸ Modifier mes inscriptions</span></button></div><div x-show="wizardOpen" class="fixed inset-0 z-50 flex items-center justify-center bg-brutal-black/90 backdrop-blur-sm p-4 overflow-y-auto" x-transition.opacity style="display:none"><div class="brutal-card bg-brutal-white w-full max-w-5xl relative flex flex-col max-h-[90vh]"><div class="border-b-4 border-brutal-black p-4 flex justify-between items-center bg-brutal-ice sticky top-0 z-10"><div><h2 class="text-2xl font-black uppercase">Assistant d'inscription</h2><div class="flex items-center gap-2 text-sm font-bold text-gray-600"><span :class="{'text-black underline': wizardStep === 1}">1. Profil</span> <span>â†’</span> <span :class="{'text-black underline': wizardStep === 2}">2. Choix des Postes</span> <span>â†’</span> <span :class="{'text-black underline': wizardStep === 3}">3. Confirmation</span></div></div><button @click="closeWizard()" class="brutal-btn p-2 text-xl hover:bg-red-500 hover:text-white transition-colors">âœ•</button></div><div class="flex-1 overflow-y-auto p-6 bg-gray-50"><div x-show="wizardStep === 1" class="text-center max-w-2xl mx-auto"><div x-show="profiles.length === 0 || showWizardProfileForm" class="mb-8 p-6 text-left max-w-lg mx-auto bg-white border-2 border-brutal-black shadow-brutal"><h4 class="text-xl font-black mb-4 uppercase bg-yellow-400 inline-block px-2">Nouveau BÃ©nÃ©vole</h4><div class="space-y-4"><div><label class="block font-bold mb-1">PrÃ©nom *</label> <input x-model="wizardProfileForm.prenom" class="w-full border-2 border-brutal-black p-2 font-bold focus:shadow-brutal focus:outline-none"></div><div><label class="block font-bold mb-1">Nom *</label> <input x-model="wizardProfileForm.nom" class="w-full border-2 border-brutal-black p-2 font-bold focus:shadow-brutal focus:outline-none"></div><div><label class="block font-bold mb-1">TÃ©lÃ©phone *</label> <input type="tel" x-model="wizardProfileForm.telephone" class="w-full border-2 border-brutal-black p-2 font-bold focus:shadow-brutal focus:outline-none"></div><div><label class="block font-bold mb-1">Taille T-Shirt *</label> <select x-model="wizardProfileForm.taille_tshirt" class="w-full border-2 border-brutal-black p-2 font-bold focus:shadow-brutal focus:outline-none bg-white"><option value="">Choisir...</option><option value="XS">XS</option><option value="S">S</option><option value="M">M</option><option value="L">L</option><option value="XL">XL</option><option value="XXL">XXL</option></select></div><div class="flex justify-between items-center mt-6 pt-4 border-t-2 border-gray-100 gap-4"><button x-show="profiles.length > 0" @click="showWizardProfileForm = false" class="brutal-btn bg-white text-brutal-black border-2 border-brutal-black px-6 py-2 font-bold shadow-brutal hover:bg-gray-100 uppercase text-sm">Annuler</button> <button @click="createProfileAndContinue()" class="brutal-btn bg-brutal-black text-brutal-white px-6 py-2 w-full shadow-brutal hover:bg-gray-800 disabled:opacity-50" :class="{'w-auto': profiles.length > 0}" :disabled="loading"><span x-show="!loading">Enregistrer & Continuer</span> <span x-show="loading">...</span></button></div></div></div><div x-show="showPostCreationModal" class="absolute inset-0 bg-white/95 z-20 flex flex-col items-center justify-center p-8 text-center" x-transition.opacity><div class="brutal-card bg-brutal-ice p-8 border-4 border-brutal-black shadow-brutal max-w-lg w-full"><h4 class="text-3xl font-black mb-6 uppercase" x-text="modalTitle || 'Profil CrÃ©Ã© ! âœ…'"></h4><p class="font-bold text-xl mb-8">Que souhaitez-vous faire maintenant ?</p><div class="flex flex-col gap-4"><button @click="handlePostProfileCreation('add')" class="brutal-btn bg-white text-brutal-black px-6 py-4 border-2 border-brutal-black font-bold hover:bg-gray-100 flex items-center justify-center gap-2"><span>â•</span> Ajouter un autre bÃ©nÃ©vole<br><span class="text-xs font-normal">(ex: conjoint, enfant...)</span></button> <button @click="handlePostProfileCreation('continue')" class="brutal-btn bg-brutal-black text-brutal-white px-6 py-4 font-bold shadow-brutal hover:bg-gray-800 flex items-center justify-center gap-2"><span>ğŸš€</span> Continuer vers le choix des Postes</button></div></div></div><div x-show="profiles.length > 0 && !showWizardProfileForm" class="grid gap-4"><p class="font-bold text-xl mb-4">Vos bÃ©nÃ©voles enregistrÃ©s :</p><template x-for="profile in profiles" :key="profile.id"><div class="brutal-card p-4 flex items-center justify-between group bg-white cursor-pointer hover:bg-gray-50 transition-colors" :class="{'border-l-8 border-l-brutal-black': wizardSelectedProfileId === profile.id}" @click="toggleWizardProfile(profile.id)"><div class="flex items-center gap-4 w-full"><span class="font-black text-xl w-full text-center" x-text="profile.prenom + ' ' + profile.nom"></span></div></div></template></div></div><div x-show="wizardStep === 2"><div class="mb-6 bg-brutal-black text-brutal-white p-3 rounded-none shadow-brutal-sm text-center"><h3 class="text-xl font-black uppercase" x-text="getCurrentWizardPeriodName()"></h3></div><div class="grid gap-6"><template x-for="subgroup in getWizardGroups()" :key="subgroup.id"><div x-data="{ openSub: subgroup.expanded }"><div @click="openSub = !openSub" class="flex justify-between items-center bg-gray-200 p-3 cursor-pointer select-none border-l-4 border-brutal-black hover:bg-gray-300 transition-colors mb-4"><h4 class="text-lg font-black uppercase text-brutal-black" x-text="subgroup.title"></h4><div class="text-xl transform transition-transform duration-300" :class="openSub ? 'rotate-180' : ''">â–¼</div></div><div class="grid gap-6 pl-0 md:pl-2" x-show="openSub" x-transition><template x-for="poste in subgroup.postes" :key="poste.poste_id"><div class="wizard-card-wrapper"><div class="brutal-card p-4" :class="isUserRegistered(poste.poste_id) ? 'bg-green-50' : 'bg-brutal-white'"><div class="mb-4 flex flex-col md:flex-row md:items-center md:gap-6"><h4 class="text-xl font-black" x-text="poste.titre"></h4><p class="text-base font-bold text-gray-700">ğŸ“… <span x-text="formatDate(poste.periode_debut)"></span> - <span x-text="formatTime(poste.periode_debut)"></span> Ã  <span x-text="formatTime(poste.periode_fin)"></span></p><div x-show="poste.referent_nom" class="md:ml-auto"><p class="font-bold">ğŸ‘¤ RÃ©fÃ©rent : <span x-text="poste.referent_nom"></span></p></div></div><div x-show="poste.description" class="mb-4 p-3 bg-gray-100 border-2 border-brutal-black"><p class="font-bold" x-text="poste.description"></p></div><div class="mb-4"><div class="flex justify-between mb-2"><span class="font-bold">Inscrits</span> <span class="font-black" x-text="poste.inscrits_actuels + ' / ' + poste.nb_max"></span></div><div class="progress-bar relative overflow-visible"><div class="progress-fill" :class="{
                'bg-red-500': poste.inscrits_actuels < (poste.nb_min || 0),
                'bg-green-400': poste.inscrits_actuels >= (poste.nb_min || 0) && poste.inscrits_actuels < poste.nb_max,
                'bg-green-700': poste.inscrits_actuels >= poste.nb_max
            }" :style="'width: ' + ((poste.inscrits_actuels / poste.nb_max) * 100) + '%'"></div><div x-show="poste.nb_min > 0" class="absolute top-0 bottom-0 w-0.5 bg-black z-10" :style="'left: ' + ((poste.nb_min / poste.nb_max) * 100) + '%'"><div class="absolute -top-6 left-1/2 transform -translate-x-1/2 text-xs font-bold whitespace-nowrap">Mini : <span x-text="poste.nb_min"></span></div></div></div></div><div class="mb-4"><template x-if="showMyInscriptions"><div x-show="getRegisteredProfiles(poste.poste_id).length > 0"><p class="font-bold mb-2">Vos inscrits :</p><div class="flex flex-wrap gap-2"><template x-for="profile in getRegisteredProfiles(poste.poste_id)" :key="profile.id"><span class="px-3 py-1 bg-green-600 text-white font-bold text-sm border-2 border-green-800"><span x-text="profile.prenom"></span></span></template></div></div></template><template x-if="!showMyInscriptions"><div x-show="poste.liste_benevoles && poste.liste_benevoles.length > 0"><p class="font-bold mb-2">BÃ©nÃ©voles inscrits :</p><div class="flex flex-wrap gap-2"><template x-for="benevole in poste.liste_benevoles" :key="benevole"><span class="px-3 py-1 bg-brutal-black text-brutal-white font-bold text-sm border-2 border-brutal-black"><span x-text="benevole"></span></span></template></div></div></template></div><div class="flex flex-col sm:flex-row gap-4 mt-6"><div x-show="profiles.length > 0" class="flex flex-wrap gap-3" :class="{'hidden md:flex': showMyInscriptions}"><template x-for="profile in profiles" :key="profile.id"><div class="inline-block"><template x-if="wizardOpen"><button x-show="isProfileRegistered(poste.poste_id, profile.id) || (!hasTimeConflict(poste, profile.id) && poste.inscrits_actuels < poste.nb_max)" @click="isProfileRegistered(poste.poste_id, profile.id) 
                                ? unregister(poste.poste_id, profile.id) 
                                : register(poste.poste_id, profile.id)" class="brutal-btn px-6 py-2 font-bold shadow-brutal-sm transition-all active:scale-95" :class="isProfileRegistered(poste.poste_id, profile.id) 
                                ? 'bg-red-500 text-white border-red-700' 
                                : 'bg-brutal-ice text-brutal-black'"><span x-text="
                                isProfileRegistered(poste.poste_id, profile.id)
                                    ? (profiles.length > 1 ? 'DÃ©sinscrire ' + profile.prenom : 'Se dÃ©sinscrire')
                                    : (profiles.length > 1 ? 'Inscrire ' + profile.prenom : 'S\'inscrire')
                            "></span></button></template><button x-show="!isProfileRegistered(poste.poste_id, profile.id) && hasTimeConflict(poste, profile.id)" disabled="disabled" class="brutal-btn px-4 py-1 font-bold border-2 border-gray-400 bg-gray-200 text-gray-500 cursor-not-allowed opacity-70 flex flex-col items-center leading-tight"><span class="line-through" x-text="profile.prenom"></span> <span class="text-[10px]">CrÃ©neau pris</span></button> <button x-show="!isProfileRegistered(poste.poste_id, profile.id) && !hasTimeConflict(poste, profile.id) && poste.inscrits_actuels >= poste.nb_max" disabled="disabled" class="brutal-btn px-4 py-1 font-bold border-2 border-gray-400 bg-gray-200 text-gray-500 cursor-not-allowed opacity-70 flex flex-col items-center leading-tight"><span x-text="profile.prenom"></span> <span class="text-[10px]">CrÃ©neau complet</span></button></div></template></div><p x-show="profiles.length === 0" class="text-red-600 font-bold italic">CrÃ©ez un profil bÃ©nÃ©vole pour vous inscrire.</p></div></div></div></template></div></div></template><div x-show="getWizardGroups().length === 0" class="text-center py-12 italic text-gray-500">Aucun poste disponible pour cette pÃ©riode.</div></div></div><div x-show="wizardStep === 3" class="max-w-3xl mx-auto"><h3 class="text-3xl font-black mb-8 text-center">RÃ©capitulatif de vos choix</h3><div class="bg-white border-2 border-brutal-black p-6 shadow-brutal mb-8"><template x-if="wizardSelections.length > 0"><div class="mb-4"><h4 class="font-bold uppercase text-green-600 border-b-2 border-green-600 mb-2">Ã€ Ajouter</h4><div class="grid gap-4"><template x-for="selection in wizardSelections" :key="selection.key"><div class="flex justify-between items-center border-b border-gray-100 pb-2"><div><p class="font-black" x-text="selection.posteTitle"></p><p class="text-sm text-gray-600"><span x-text="formatDate(selection.debut)"></span> â€¢ <span x-text="formatTime(selection.debut)"></span> - <span x-text="formatTime(selection.fin)"></span></p><p class="text-xs font-bold text-blue-600 mt-1">ğŸ‘¤ pour <span x-text="selection.profileName"></span></p></div><button @click="wizardUnregister(selection.posteId, selection.profileId)" class="text-red-500 font-bold hover:underline text-sm">Annuler</button></div></template></div></div></template><template x-if="wizardRemovals.length > 0"><div><h4 class="font-bold uppercase text-red-600 border-b-2 border-red-600 mb-2">Ã€ Supprimer</h4><div class="grid gap-4"><template x-for="rem in getRemovalDetailsList()" :key="rem.key"><div class="flex justify-between items-center border-b border-gray-100 pb-2 bg-red-50 p-2"><div><p class="font-black line-through text-gray-500" x-text="rem.posteTitle"></p><p class="text-sm text-gray-400"><span x-text="formatDate(rem.debut)"></span></p><p class="text-xs font-bold text-gray-500 mt-1">ğŸ‘¤ <span x-text="rem.profileName"></span></p></div><button @click="wizardRemovals = wizardRemovals.filter(k => k !== rem.key); loadPostes()" class="text-green-600 font-bold hover:underline text-sm">Restaurer</button></div></template></div></div></template><template x-if="wizardSelections.length === 0 && wizardRemovals.length === 0"><p class="text-center italic text-gray-500">Aucun changement pour le moment.</p></template></div><div class="text-center"><p class="mb-4 font-bold">Tout est bon pour vous ?</p></div></div></div><div class="border-t-4 border-brutal-black p-4 bg-gray-100 flex justify-between items-center sticky bottom-0 z-10"><div class="flex gap-2"><button x-show="wizardStep > 1" @click="wizardStep === 2 && wizardPeriodIndex > 0 ? prevPeriod() : wizardStep--" class="brutal-btn bg-white px-6 py-3 border-2 border-brutal-black font-bold">Retour</button></div><div><button x-show="wizardStep === 1 && profiles.length > 0 && !showWizardProfileForm" @click="modalTitle = 'C\'est parti !'; showPostCreationModal = true" class="brutal-btn bg-brutal-black text-brutal-white px-8 py-3 font-bold shadow-brutal disabled:opacity-50 disabled:cursor-not-allowed">Continuer â†’</button> <button x-show="wizardStep === 2 && (getWizardPeriods() && wizardPeriodIndex < getWizardPeriods().length - 1)" @click="nextPeriod()" class="brutal-btn bg-brutal-black text-brutal-white px-8 py-3 font-bold shadow-brutal">Suivant â†’</button> <button x-show="wizardStep === 2 && (getWizardPeriods() && wizardPeriodIndex >= getWizardPeriods().length - 1)" @click="wizardStep = 3" class="brutal-btn bg-yellow-400 text-black px-8 py-3 font-bold shadow-brutal border-2 border-black">VÃ©rifier et Valider (<span x-text="wizardSelections.length + wizardRemovals.length"></span>)</button> <button x-show="wizardStep === 3" @click="submitWizard()" class="brutal-btn bg-green-500 text-white px-8 py-3 font-bold shadow-brutal border-2 border-black disabled:opacity-50" :disabled="(wizardSelections.length === 0 && wizardRemovals.length === 0) || loading"><span x-show="!loading">Valider mes inscriptions ğŸ‰</span> <span x-show="loading">Validation...</span></button></div></div></div></div></body></html>